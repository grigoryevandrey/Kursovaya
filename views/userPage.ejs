<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= name%> <%= lastName%></title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/nav.css">
  <link rel="stylesheet" href="/userPage.css">

</head>

<body>
  <nav>
    <div class="logo">
      <a href="/"><h4>Заголовок</h4></a>
    </div>
    <ul class="nav-links">
      <li>
        <a href="/users/login">Войти</a>
      </li>
      <li>
        <a href="/users/register">Зарегистрироваться</a>
      </li>
      <li>
        <a href="/search">Поиск</a>
      </li>
      <li>
        <a href="#">Связаться с нами</a>
      </li>
    </ul>
    <div class="burger">
      <div class="line1"></div>
      <div class="line2"></div>
      <div class="line3"></div>
    </div>
  </nav>


  <div class="mainBox">
    <div class="headbox">    
      <div id="avatarCont"><img id="avatar" height="200px" width="160px" alt="Нет аватара"></div>
      <div id="name"><%= name%> <%= lastName%></div>
      <div id="subject"><%= subject%></div>
      <div id="rating">Средняя оценка: <span><%= rating%></span></div> 
   </div>
    <div class="bodyBox">   
      <div id="gender">Пол: <%= gender%></div>
      <div id="yearOfBirth">Год рождения: <%= yearOfBirth%></div>
      <div id="lengthOfLesson">Длительность занятия: <%= lengthOfLesson%></div>
      <div id="achievements">Достижения: <%= achievements%></div>
      <div id="additionalInfo">Доп инфа: <%= additionalInfo%></div>
      <div id="buyFormBottom">
        <div id="pricePerLesson"><%= pricePerLesson%> руб/занятие
        </div>
        <div id="buyBtn">
          <button>
            Купить уроки
          </button>
        </div>
      </div>
      
    <div class="reviews" id="reviews">


    </div>
  </div>



    <form action="/review" method="post" class="reviewBox">

      <label for="rating">Оценка: </label>
      <select name="rating" id="rating">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>

      <input type="text" name="teacherId" id="teacherId" value="<%= id%>">

      <label for="phoneOfCustomer">Ваш номер телефона: </label>
      <input type="text" name="phoneOfCustomer" id="phoneOfCustomer">

      <label for="review">Ваш отзыв:</label>
      <textarea name="review" id="review" rows="8" cols="40"></textarea>

      <input type="submit" name="" value="Оставить отзыв">

    </form>
  </div>
  <script>
    var Base64 = {
      _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
      encode: function (e) {
        var t = "";
        var n, r, i, s, o, u, a;
        var f = 0;
        e = Base64._utf8_encode(e);
        while (f < e.length) {
          n = e.charCodeAt(f++);
          r = e.charCodeAt(f++);
          i = e.charCodeAt(f++);
          s = n >> 2;
          o = (n & 3) << 4 | r >> 4;
          u = (r & 15) << 2 | i >> 6;
          a = i & 63;
          if (isNaN(r)) {
            u = a = 64
          } else if (isNaN(i)) {
            a = 64
          }
          t = t + this._keyStr.charAt(s) + this._keyStr.charAt(o) + this._keyStr.charAt(u) + this
            ._keyStr.charAt(a)
        }
        return t
      },
      decode: function (e) {
        var t = "";
        var n, r, i;
        var s, o, u, a;
        var f = 0;
        e = e.replace(/[^A-Za-z0-9\+\/\=]/g, "");
        while (f < e.length) {
          s = this._keyStr.indexOf(e.charAt(f++));
          o = this._keyStr.indexOf(e.charAt(f++));
          u = this._keyStr.indexOf(e.charAt(f++));
          a = this._keyStr.indexOf(e.charAt(f++));
          n = s << 2 | o >> 4;
          r = (o & 15) << 4 | u >> 2;
          i = (u & 3) << 6 | a;
          t = t + String.fromCharCode(n);
          if (u != 64) {
            t = t + String.fromCharCode(r)
          }
          if (a != 64) {
            t = t + String.fromCharCode(i)
          }
        }
        t = Base64._utf8_decode(t);
        return t
      },
      _utf8_encode: function (e) {
        e = e.replace(/\r\n/g, "\n");
        var t = "";
        for (var n = 0; n < e.length; n++) {
          var r = e.charCodeAt(n);
          if (r < 128) {
            t += String.fromCharCode(r)
          } else if (r > 127 && r < 2048) {
            t += String.fromCharCode(r >> 6 | 192);
            t += String.fromCharCode(r & 63 | 128)
          } else {
            t += String.fromCharCode(r >> 12 | 224);
            t += String.fromCharCode(r >> 6 & 63 | 128);
            t += String.fromCharCode(r & 63 | 128)
          }
        }
        return t
      },
      _utf8_decode: function (e) {
        var t = "";
        var n = 0;
        var r = c1 = c2 = 0;
        while (n < e.length) {
          r = e.charCodeAt(n);
          if (r < 128) {
            t += String.fromCharCode(r);
            n++
          } else if (r > 191 && r < 224) {
            c2 = e.charCodeAt(n + 1);
            t += String.fromCharCode((r & 31) << 6 | c2 & 63);
            n += 2
          } else {
            c2 = e.charCodeAt(n + 1);
            c3 = e.charCodeAt(n + 2);
            t += String.fromCharCode((r & 15) << 12 | (c2 & 63) << 6 | c3 & 63);
            n += 3
          }
        }
        return t
      }
    }

    document.addEventListener('DOMContentLoaded', function () {
      if ( <%= id %> ) {
        document.getElementById('avatar').src = "/userPhotos/" + <%= id %> +".jpg";
      }
      let lengthReviewsArray = "<%= reviewLength %>";
      let reviewsArray = {};
      let counter = 1;
      reviewsArray  = <%- resultsReviewFunction() %> ;
      reviewsArray = JSON.parse(reviewsArray);

      let reviewsContainer = document.getElementById('reviews');
      let pageReviewsContainer = '';


      for (let i = 0; i < lengthReviewsArray; i++) {

        if (counter === 1) {
          pageReviewsContainer = document.createElement('div');
          pageReviewsContainer.id = 'pageReviewsContainer';
          pageReviewsContainer.className = 'pageReviewsContainer';
        }

        let searchReviewsContainer = document.createElement('div');
                searchReviewsContainer.id = 'searchReviewsContainer';
                searchReviewsContainer.className = 'searchReviewsContainer';

                if (reviewsArray[0].message === "Нет отзывов"){
                    let noReviewsCont = document.createElement('div');
                noReviewsCont.id = 'noReviewsCont';
                noReviewsCont.className = 'noReviewsCont';
                noReviewsCont.textContent = `Нет отзывов`;
                searchReviewsContainer.append(noReviewsCont);

                }
                else{

                  
                let ratingCont = document.createElement('div');
                ratingCont.id = 'ratingCont';
                ratingCont.className = 'ratingCont';
                ratingCont.innerHTML = `Оценка: <span>${reviewsArray[i].rating}</span>`;
                searchReviewsContainer.append(ratingCont);


                let dateCont = document.createElement('div');
                dateCont.id = 'dateCont';
                dateCont.className = 'dateCont';
                dateCont.textContent = `Дата: ${i}`;
                searchReviewsContainer.append(dateCont);

                    let nameReviewsCont = document.createElement('div');
                nameReviewsCont.id = 'nameReviewsCont';
                nameReviewsCont.className = 'nameReviewsCont';
                nameReviewsCont.textContent = `Написал: ${reviewsArray[i].full_name}`;
                searchReviewsContainer.append(nameReviewsCont);

                  


                let reviewCont = document.createElement('div');
                reviewCont.id = 'reviewCont';
                reviewCont.className ='reviewCont';
                reviewCont.textContent = `Отзыв: ${reviewsArray[i].review}`;
                searchReviewsContainer.append(reviewCont);

                
              }

              pageReviewsContainer.append(searchReviewsContainer);
              

              if (counter === 5) {
                reviews.append(pageReviewsContainer);
                counter = 1;
              } else { 
              counter++;
              }
              
              
            }

            let reviewPages = document.querySelectorAll('#pageReviewsContainer');

            reviewPages[0].classList.add('visible-review-page');
    }, false);
  </script>
</body>

</html>